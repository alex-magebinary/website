<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <template id="assets_frontend" inherit_id="website.assets_frontend">
            <xpath expr="." position="inside">
                <script
                    type="text/javascript"
                    src="/website_sale_one_step_checkout/static/src/js/website_sale_osc_tour.js"/>

                <script type="text/javascript"
                            src="/website_sale_one_step_checkout/static/src/js/website_sale_osc.js"></script>
            </xpath>
        </template>

        <template id="osc_onestepcheckout">
             <t t-call="website.layout">
                <t t-set="additional_title">Shop - Checkout</t>
                <div id="wrap">
                    <div class="container oe_website_sale">
                        <t t-set="same_shipping" t-value="bool(order.partner_shipping_id==order.partner_id or only_services)" />
                        <!--/t[1]/t[1]/div[1]/div[1]/div[1]/-->
                        <div class="row">
                            <div class="col-md-4 oe_cart">
                                <div class="row">
                                    <div class="col-md-12">
                                        <h3 class="page-header mt16">
                                            Billing Address
                                            <small t-if="website.user_id == user_id">
										    or
										    <a class='btn btn-primary' t-attf-href="/web/login?redirect=#{ request.httprequest.url }">
											Sign in
										    </a>
                                            </small>
                                        </h3>
                                    </div>
                                    <div class="col-md-12 one_kanban">
                                        <!--order.partner_id.id == request.website.user_id.sudo().partner_id.id-->
										<t t-if="website.user_id == user_id">
											<div>Nope sorry, mate</div>
										</t>
                                        <!--order.partner_id.id != request.website.user_id.sudo().partner_id.id-->
										<t t-if="website.user_id != user_id">
                                            <t t-call="website_sale.address_kanban">
                                                <t t-set='contact' t-value="order.partner_id"/>
                                                <t t-set='selected' t-value="1"/>
                                                <t t-set='readonly' t-value="1"/>
                                            </t>
                                        </t>
                                    </div>
                                </div>
                                <!--/t[1]/t[1]/div[1]/div[1]/div[1]/div[1]/div[2]-->
                                <t t-if="not only_services">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h3 class="page-header mt16">Shipping Address
                                            </h3>
                                        </div>
                                    </div>
                                    <div class="row all_shipping">
                                        <div class="col-md-12">
                                            <div class="row mt8">
                                                <div class="col-sm-12 col-md-12 one_kanban">
                                                    <form action="/shop/address" method="post" class=''>
                                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                        <a class='a-submit btn btn-default mb16 btn-block'>
                                                            <i class="fa fa-plus-square" aria-hidden="true"></i> Add an address
                                                        </a>
                                                    </form>
                                                </div>
                                                <t t-foreach="shippings" t-as="ship">
                                                    <div class="col-sm-12 col-md-12 one_kanban">
                                                        <t t-call="website_sale.address_kanban">
                                                            <t t-set='contact' t-value="ship"/>
                                                            <t t-set='selected' t-value="order.partner_shipping_id==ship"/>
                                                            <t t-set='readonly' t-value="bool(len(shippings)==1)"/>
                                                            <t t-set='edit_billing' t-value="bool(ship==order.partner_id)"/>
                                                        </t>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                                <div class="clearfix" />
                            </div>

                            <!--Modal for Public User Address-->
                            <!--TODO: Implement Modal-->


                                        <!-- Delivery Methods Start -->
                            <div id="col-2" class="col-md-4 oe_mycart">
                                <div t-if="deliveries" id="delivery_carrier_osc">
                                    <h3 class="page-header mt16">Delivery Method</h3>
                                        <ul class="list-unstyled">
                                            <t t-foreach="deliveries" t-as="delivery">
                                                <li>
                                                    <label t-if="delivery.available">
                                                        <input t-att-value="delivery.id" type="radio" name="delivery_type"
                                                            t-att-checked="order.carrier_id and order.carrier_id.id == delivery.id and 'checked' or False"/>
                                                        <abbr t-att-title="delivery.website_description"><span t-field="delivery.name"/></abbr>
                                                        <span class="badge" t-field="delivery.price"
                                                            t-options='{
                                                                "widget": "monetary",
                                                                "from_currency": delivery.product_id.company_id.currency_id,
                                                                "display_currency": website_sale_order.currency_id
                                                            }'/>
                                                        <div t-field="delivery.website_description" class="text-muted"/>
                                                    </label>
                                                </li>
                                            </t>
                                        </ul>
                                </div>
                                <!-- Delivery Methods End -->

                                <!-- Payment Part -->
                                <div t-if="acquirers and website_sale_order.amount_total" id="payment_method">
                                    <h3 class="page-header mt16">Payment Method</h3>
                                    <ul class="list-unstyled">
                                        <t t-foreach="acquirers or list()" t-as="acquirer">
                                            <li>
                                                <label t-if="acquirer.button">
                                                    <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer" />
                                                        <span t-field="acquirer.image_small" t-att-title="acquirer.name"
                                                              t-field-options='{"widget": "image", "style":"max-width: 60px; display: inline-block"}'/>
                                                        <span t-field="acquirer.name" />
                                                        <span t-if="acquirer.fees_active">(processing fees apply)</span>
                                                </label>
                                            </li>
                                        </t>
                                        <li t-if="tokens">
                                            <label>
                                                <input type="radio" name="acquirer" />
                                                <span class='fa fa-2x fa-credit-card'/>
                                                Saved Cards
                                            </label>

                                            <div class="list-group">
                                                <t t-foreach='tokens' t-as='token'>
                                                    <a class="list-group-item btn_payment_token" t-att-data-acquirer="token.acquirer_id.id" t-att-data-token='token.id'>
                                                        <span class="js_radio fa fa-circle-o"></span>&amp;nbsp;
                                                        <t t-esc="token.name" />
                                                        <t t-if="len(set(tokens.mapped('acquirer_id')))>1">
                                                            (<t t-esc='token.acquirer_id.name'/>)
                                                        </t>
                                                        <span t-if="token.acquirer_id.fees_active">(processing fees apply)</span>
                                                    </a>
                                                </t>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>


                            <!-- Cart review -->
                            <div id="col-3" class="col-md-4 oe_mycart">
                                <h3 class="page-header mt16">Review Order
                                <small>
                                    <a href="/shop/cart">
                                        <span class="fa fa-arrow-right"/>
                                        change
                                    </a>
                                </small>
                                </h3>

                                <div>
                                    <table class="table table-striped table-condensed" id="cart_products" t-if="website_sale_order and website_sale_order.website_order_line">
                                        <thead>
                                            <tr>
                                                <th width="80">Product</th>
                                                <th></th>
                                                <th width="120">Quantity</th>
                                                <th width="100" class='text-center'>Price</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="website_sale_order.website_order_line" t-as="line">
                                                <td colspan="2" t-if="not line.product_id.product_tmpl_id"></td>
                                                <td t-if="line.product_id.product_tmpl_id">
                                                    <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                                                        <span t-field="line.product_id.image_small" t-options="{'widget': 'image', 'class': 'img-rounded'}" />
                                                    </a>
                                                </td>
                                                <td t-if="line.product_id.product_tmpl_id">
                                                    <div>
                                                        <strong t-field="line.product_id.with_context(display_default_code=False).display_name" />
                                                    </div>
                                                    <!--Commented out description of item. Takes up too much space.-->
                                                    <!--<div class="text-muted">-->
                                                        <!--&lt;!&ndash;<Display only 1st important part of description&ndash;&gt;-->
                                                            <!--<span><t t-esc="line.name.splitlines()[1]"/></span><br/>-->
                                                        <!--&lt;!&ndash;</t>&ndash;&gt;-->
                                                    <!--</div>-->
                                                </td>
                                                <td>
                                                    <div t-esc="line.product_uom_qty" />
                                                </td>
                                                <td class="text-center">
                                                    <span t-field="line.price_unit" style="white-space: nowrap;" t-options="{'widget': 'monetary','from_currency': website_sale_order.pricelist_id.currency_id,'display_currency': website.currency_id}" />
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <t t-call="website_sale.total"/>
                                    <div class="clearfix"/>
                                </div>

                                <div groups="website_sale_one_step_checkout.group_website_sale_terms_conditions">
                                    <ul>
                                        <label class="checkbox checkbox-modal-link">
                                            <input type="checkbox" name="terms_conditions"/>
                                            I've accepted the
                                            <a href="javascript:;"
                                               data-page-id="/page/terms_and_conditions/"
                                               title="Terms and Conditions">Terms &amp;
                                                Conditions
                                            </a>
                                        </label>
                                    </ul>
                                </div>

                                <div groups="website_sale_osc.group_website_sale_terms_conditions">
									<ul>
										<label class="checkbox checkbox-modal-link">
											<input type="checkbox" name="terms_conditions"/>
											I've accepted the
											<a href="javascript:;"
											   data-page-id="/page/terms_and_conditions/"
											   title="Terms and Conditions">Terms &amp;
												Condtions
											</a>
										</label>
									</ul>
								</div>

                             <!--TODO: MOVE THIS PAYMENT BUTTON-->
                                    <!--For some reasons the button is displayed even when removing-->
                                    <!--the second div below. When I move both divs to the cart -->
                                    <!--review section, then no button is displayed. So the if clause-->
                                    <!--must suddenly be true for some reason. Figure out why!-->
                                    <div class="row js_payment TEST">
                                        <div class="col-md-12 mb32">
                                            <t t-foreach="acquirers or []" t-as="acquirer" id="acquirers_list">
                                                <div t-att-data-id="acquirer.id" class="oe_sale_acquirer_button hidden pull-right">
                                                    <div t-raw="acquirer.button" />
                                                    <div class="token_hide">
                                                        <div t-if="acquirer.save_token == 'ask'">
                                                            <input type="checkbox" name="odoo_save_token"/>
                                                            <label for="odoo_save_token">Save my payment data</label>
                                                        </div>
                                                        <div class="pre_msg" t-field="acquirer.pre_msg" />
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                    <div class="js_payment mb64 row" t-if="not website_sale_order.amount_total" id="payment_method">
                                        <div class="col-md-12 mb32">
                                            <form target="_self" action="/shop/payment/validate" method="post" class="pull-right">
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                <a style="width:127px;" class="btn btn-primary a-submit">
                                                    <span t-if="order.amount_total &gt; 0">Pay Now <span class="fa fa-long-arrow-right"></span></span>
                                                    <span t-if="order.amount_total == 0">Confirm Order <span class="fa fa-long-arrow-right"></span></span>
                                                </a>
                                            </form>
                                        </div>
                                    </div>
                            </div>

                        </div>
                    </div>
                    <div class="oe_structure" />
                </div>

                 <!-- Modal for terms and conditions -->
				<div class="modal fade" id="checkbox-modal" tabindex="-1" role="dialog"
					 aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
										aria-hidden="true">X
								</button>
								<h4 class="modal-title">Informationen</h4>
							</div>
							<div class="modal-body"></div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">
									Close
								</button>
							</div>
						</div>
					</div>
				</div>

             </t>
        </template>

        <!-- Checkout Terms & Conditions -->
		<template id="checkout_terms" name="Terms And Conditions">
			<t t-call="website.layout">
				<div id="wrap" class="oe_structure oe_empty">
					<section>
						<div class="container">
							<div class="row">
								<div class="col-md-12">
									<h1 class="text-center">Edit your Terms And Conditions</h1>
									<h4 class="text-muted">By using the Websitebuilder.
										You find the Terms of conditions page by using the link in
										the footer or click on this picture.
									</h4>
								</div>
							</div>
						</div>
					</section>
					<section class="oe_dark mt16 mb16">
						<div class="container">
							<div class="row">
								<div class="col-md-12">
									<a href="/page/terms_and_conditions/">
										<img alt="Odoo CMS - a big picture"
											 class="img img-responsive"
											 src="/website_sale_one_step_checkout/static/src/img/terms.png"
											 style="margin: 0 auto;"/>
									</a>
								</div>
							</div>
						</div>
					</section>
				</div>
			</t>
		</template>

        <!-- Include terms and condition link in footer -->
		<template id="footer_terms" inherit_id="website.footer_default" name="Footer Terms">
			<xpath expr="//ul[@id='products']/li" position="inside">
				<li>
					<a href="/page/terms_and_conditions/">Terms &amp; Conditions</a>
				</li>
			</xpath>
		</template>
    </data>
</odoo>
